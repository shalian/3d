var qn=Object.defineProperty;var _n=(r,e,t)=>e in r?qn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ue=(r,e,t)=>(_n(r,typeof e!="symbol"?e+"":e,t),t);import{d as $n,r as jt,i as Qn,o as Jn,a as Nn,c as er,b as _e,w as tr,v as nr,e as rr,f as ir,g as ar,t as sr}from"./index-LkW88So4.js";import{d as ct,V as pe,v as or,L as lr,w as Ft,x as cr,T as gt,p as Xt,y as Ht,z as Zt,E as $e,G as an,C as ie,H as Ze,J as ur,a as b,K as mt,N as Kt,O as tt,Q as ft,X as fr,b as hr,s as Wt,r as ae,Y as sn,Z as on,_ as pr,M as Qe,$ as vr,a0 as gr,a1 as mr,a2 as ln,k as Ke,a3 as ye,a4 as dr,a5 as yr,a6 as wr,a7 as Re,a8 as xr,a9 as We,aa as Tr,ab as Ir,m as Ar,o as Yt,ac as Fr,D as qt,n as Pr,e as Dr,ad as Mr,ae as Sr}from"./WebglThreeRender-u18XZJgw.js";import{L as Lr,G as Cr}from"./loading-EC5GHeqY.js";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var _t={},dt=function(r){return URL.createObjectURL(new Blob([r],{type:"text/javascript"}))},cn=function(r){return new Worker(r)};try{URL.revokeObjectURL(dt(""))}catch{dt=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},cn=function(e){return new Worker(e,{type:"module"})}}var Er=function(r,e,t,n,i){var a=cn(_t[e]||(_t[e]=dt(r)));return a.onerror=function(s){return i(s.error,null)},a.onmessage=function(s){return i(null,s.data)},a.postMessage(t,n),a},M=Uint8Array,V=Uint16Array,le=Uint32Array,Fe=new M([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Pe=new M([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ze=new M([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),un=function(r,e){for(var t=new V(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new le(t[30]),n=1;n<30;++n)for(var a=t[n];a<t[n+1];++a)i[a]=a-t[n]<<5|n;return[t,i]},fn=un(Fe,2),Pt=fn[0],nt=fn[1];Pt[28]=258,nt[258]=28;var hn=un(Pe,0),pn=hn[0],yt=hn[1],Oe=new V(32768);for(var R=0;R<32768;++R){var fe=(R&43690)>>>1|(R&21845)<<1;fe=(fe&52428)>>>2|(fe&13107)<<2,fe=(fe&61680)>>>4|(fe&3855)<<4,Oe[R]=((fe&65280)>>>8|(fe&255)<<8)>>>1}var J=function(r,e,t){for(var n=r.length,i=0,a=new V(e);i<n;++i)++a[r[i]-1];var s=new V(e);for(i=0;i<e;++i)s[i]=s[i-1]+a[i-1]<<1;var o;if(t){o=new V(1<<e);var l=15-e;for(i=0;i<n;++i)if(r[i])for(var u=i<<4|r[i],f=e-r[i],c=s[r[i]-1]++<<f,h=c|(1<<f)-1;c<=h;++c)o[Oe[c]>>>l]=u}else for(o=new V(n),i=0;i<n;++i)r[i]&&(o[i]=Oe[s[r[i]-1]++]>>>15-r[i]);return o},ce=new M(288);for(var R=0;R<144;++R)ce[R]=8;for(var R=144;R<256;++R)ce[R]=9;for(var R=256;R<280;++R)ce[R]=7;for(var R=280;R<288;++R)ce[R]=8;var Ie=new M(32);for(var R=0;R<32;++R)Ie[R]=5;var vn=J(ce,9,0),gn=J(ce,9,1),mn=J(Ie,5,0),dn=J(Ie,5,1),Je=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},Q=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Ne=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Ge=function(r){return(r/8|0)+(r&7&&1)},N=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new(r instanceof V?V:r instanceof le?le:M)(t-e);return n.set(r.subarray(e,t)),n},Ve=function(r,e,t){var n=r.length;if(!n||t&&!t.l&&n<5)return e||new M(0);var i=!e||t,a=!t||t.i;t||(t={}),e||(e=new M(n*3));var s=function(He){var ke=e.length;if(He>ke){var de=new M(Math.max(ke*2,He));de.set(e),e=de}},o=t.f||0,l=t.p||0,u=t.b||0,f=t.l,c=t.d,h=t.m,p=t.n,v=n*8;do{if(!f){t.f=o=Q(r,l,1);var g=Q(r,l+1,3);if(l+=3,g)if(g==1)f=gn,c=dn,h=9,p=5;else if(g==2){var m=Q(r,l,31)+257,T=Q(r,l+10,15)+4,P=m+Q(r,l+5,31)+1;l+=14;for(var A=new M(P),I=new M(19),y=0;y<T;++y)I[ze[y]]=Q(r,l+y*3,7);l+=T*3;for(var B=Je(I),F=(1<<B)-1,j=J(I,B,1),y=0;y<P;){var E=j[Q(r,l,F)];l+=E&15;var d=E>>>4;if(d<16)A[y++]=d;else{var L=0,C=0;for(d==16?(C=3+Q(r,l,3),l+=2,L=A[y-1]):d==17?(C=3+Q(r,l,7),l+=3):d==18&&(C=11+Q(r,l,127),l+=7);C--;)A[y++]=L}}var O=A.subarray(0,m),k=A.subarray(m);h=Je(O),p=Je(k),f=J(O,h,1),c=J(k,p,1)}else throw"invalid block type";else{var d=Ge(l)+4,x=r[d-4]|r[d-3]<<8,w=d+x;if(w>n){if(a)throw"unexpected EOF";break}i&&s(u+x),e.set(r.subarray(d,w),u),t.b=u+=x,t.p=l=w*8;continue}if(l>v){if(a)throw"unexpected EOF";break}}i&&s(u+131072);for(var z=(1<<h)-1,H=(1<<p)-1,W=l;;W=l){var L=f[Ne(r,l)&z],$=L>>>4;if(l+=L&15,l>v){if(a)throw"unexpected EOF";break}if(!L)throw"invalid length/literal";if($<256)e[u++]=$;else if($==256){W=l,f=null;break}else{var Z=$-254;if($>264){var y=$-257,te=Fe[y];Z=Q(r,l,(1<<te)-1)+Pt[y],l+=te}var ne=c[Ne(r,l)&H],Y=ne>>>4;if(!ne)throw"invalid distance";l+=ne&15;var k=pn[Y];if(Y>3){var te=Pe[Y];k+=Ne(r,l)&(1<<te)-1,l+=te}if(l>v){if(a)throw"unexpected EOF";break}i&&s(u+131072);for(var X=u+Z;u<X;u+=4)e[u]=e[u-k],e[u+1]=e[u+1-k],e[u+2]=e[u+2-k],e[u+3]=e[u+3-k];u=X}}t.l=f,t.p=W,t.b=u,f&&(o=1,t.m=h,t.d=c,t.n=p)}while(!o);return u==e.length?e:N(e,0,u)},re=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>>8},xe=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>>8,r[n+2]|=t>>>16},et=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var i=t.length,a=t.slice();if(!i)return[oe,0];if(i==1){var s=new M(t[0].s+1);return s[t[0].s]=1,[s,1]}t.sort(function(P,A){return P.f-A.f}),t.push({s:-1,f:25001});var o=t[0],l=t[1],u=0,f=1,c=2;for(t[0]={s:-1,f:o.f+l.f,l:o,r:l};f!=i-1;)o=t[t[u].f<t[c].f?u++:c++],l=t[u!=f&&t[u].f<t[c].f?u++:c++],t[f++]={s:-1,f:o.f+l.f,l:o,r:l};for(var h=a[0].s,n=1;n<i;++n)a[n].s>h&&(h=a[n].s);var p=new V(h+1),v=rt(t[f-1],p,0);if(v>e){var n=0,g=0,d=v-e,x=1<<d;for(a.sort(function(A,I){return p[I.s]-p[A.s]||A.f-I.f});n<i;++n){var w=a[n].s;if(p[w]>e)g+=x-(1<<v-p[w]),p[w]=e;else break}for(g>>>=d;g>0;){var m=a[n].s;p[m]<e?g-=1<<e-p[m]++-1:++n}for(;n>=0&&g;--n){var T=a[n].s;p[T]==e&&(--p[T],++g)}v=e}return[new M(p),v]},rt=function(r,e,t){return r.s==-1?Math.max(rt(r.l,e,t+1),rt(r.r,e,t+1)):e[r.s]=t},wt=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new V(++e),n=0,i=r[0],a=1,s=function(l){t[n++]=l},o=1;o<=e;++o)if(r[o]==i&&o!=e)++a;else{if(!i&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(i),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(i);a=1,i=r[o]}return[t.subarray(0,n),e]},Te=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},Be=function(r,e,t){var n=t.length,i=Ge(e+2);r[i]=n&255,r[i+1]=n>>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var a=0;a<n;++a)r[i+a+4]=t[a];return(i+4+n)*8},xt=function(r,e,t,n,i,a,s,o,l,u,f){re(e,f++,t),++i[256];for(var c=et(i,15),h=c[0],p=c[1],v=et(a,15),g=v[0],d=v[1],x=wt(h),w=x[0],m=x[1],T=wt(g),P=T[0],A=T[1],I=new V(19),y=0;y<w.length;++y)I[w[y]&31]++;for(var y=0;y<P.length;++y)I[P[y]&31]++;for(var B=et(I,7),F=B[0],j=B[1],E=19;E>4&&!F[ze[E-1]];--E);var L=u+5<<3,C=Te(i,ce)+Te(a,Ie)+s,O=Te(i,h)+Te(a,g)+s+14+3*E+Te(I,F)+(2*I[16]+3*I[17]+7*I[18]);if(L<=C&&L<=O)return Be(e,f,r.subarray(l,l+u));var k,z,H,W;if(re(e,f,1+(O<C)),f+=2,O<C){k=J(h,p,0),z=h,H=J(g,d,0),W=g;var $=J(F,j,0);re(e,f,m-257),re(e,f+5,A-1),re(e,f+10,E-4),f+=14;for(var y=0;y<E;++y)re(e,f+3*y,F[ze[y]]);f+=3*E;for(var Z=[w,P],te=0;te<2;++te)for(var ne=Z[te],y=0;y<ne.length;++y){var Y=ne[y]&31;re(e,f,$[Y]),f+=F[Y],Y>15&&(re(e,f,ne[y]>>>5&127),f+=ne[y]>>>12)}}else k=vn,z=ce,H=mn,W=Ie;for(var y=0;y<o;++y)if(n[y]>255){var Y=n[y]>>>18&31;xe(e,f,k[Y+257]),f+=z[Y+257],Y>7&&(re(e,f,n[y]>>>23&31),f+=Fe[Y]);var X=n[y]&31;xe(e,f,H[X]),f+=W[X],X>3&&(xe(e,f,n[y]>>>5&8191),f+=Pe[X])}else xe(e,f,k[n[y]]),f+=z[n[y]];return xe(e,f,k[256]),f+z[256]},yn=new le([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),oe=new M(0),wn=function(r,e,t,n,i,a){var s=r.length,o=new M(n+s+5*(1+Math.ceil(s/7e3))+i),l=o.subarray(n,o.length-i),u=0;if(!e||s<8)for(var f=0;f<=s;f+=65535){var c=f+65535;c<s?u=Be(l,u,r.subarray(f,c)):(l[f]=a,u=Be(l,u,r.subarray(f,s)))}else{for(var h=yn[e-1],p=h>>>13,v=h&8191,g=(1<<t)-1,d=new V(32768),x=new V(g+1),w=Math.ceil(t/3),m=2*w,T=function(ut){return(r[ut]^r[ut+1]<<w^r[ut+2]<<m)&g},P=new le(25e3),A=new V(288),I=new V(32),y=0,B=0,f=0,F=0,j=0,E=0;f<s;++f){var L=T(f),C=f&32767,O=x[L];if(d[C]=O,x[L]=C,j<=f){var k=s-f;if((y>7e3||F>24576)&&k>423){u=xt(r,l,0,P,A,I,B,F,E,f-E,u),F=y=B=0,E=f;for(var z=0;z<286;++z)A[z]=0;for(var z=0;z<30;++z)I[z]=0}var H=2,W=0,$=v,Z=C-O&32767;if(k>2&&L==T(f-Z))for(var te=Math.min(p,k)-1,ne=Math.min(32767,f),Y=Math.min(258,k);Z<=ne&&--$&&C!=O;){if(r[f+H]==r[f+H-Z]){for(var X=0;X<Y&&r[f+X]==r[f+X-Z];++X);if(X>H){if(H=X,W=Z,X>te)break;for(var He=Math.min(Z,X-2),ke=0,z=0;z<He;++z){var de=f-Z+z+32768&32767,Yn=d[de],Ut=de-Yn+32768&32767;Ut>ke&&(ke=Ut,O=de)}}}C=O,O=d[C],Z+=C-O+32768&32767}if(W){P[F++]=268435456|nt[H]<<18|yt[W];var Gt=nt[H]&31,Vt=yt[W]&31;B+=Fe[Gt]+Pe[Vt],++A[257+Gt],++I[Vt],j=f+H,++y}else P[F++]=r[f],++A[r[f]]}}u=xt(r,l,a,P,A,I,B,F,E,f-E,u),!a&&u&7&&(u=Be(l,u+1,oe))}return N(o,0,n+Ge(u)+i)},xn=function(){for(var r=new le(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;r[e]=t}return r}(),De=function(){var r=-1;return{p:function(e){for(var t=r,n=0;n<e.length;++n)t=xn[t&255^e[n]]^t>>>8;r=t},d:function(){return~r}}},Dt=function(){var r=1,e=0;return{p:function(t){for(var n=r,i=e,a=t.length,s=0;s!=a;){for(var o=Math.min(s+2655,a);s<o;++s)i+=n+=t[s];n=(n&65535)+15*(n>>16),i=(i&65535)+15*(i>>16)}r=n,e=i},d:function(){return r%=65521,e%=65521,(r&255)<<24|r>>>8<<16|(e&255)<<8|e>>>8}}},me=function(r,e,t,n,i){return wn(r,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):12+e.mem,t,n,!i)},je=function(r,e){var t={};for(var n in r)t[n]=r[n];for(var n in e)t[n]=e[n];return t},$t=function(r,e,t){for(var n=r(),i=r.toString(),a=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),s=0;s<n.length;++s){var o=n[s],l=a[s];if(typeof o=="function"){e+=";"+l+"=";var u=o.toString();if(o.prototype)if(u.indexOf("[native code]")!=-1){var f=u.indexOf(" ",8)+1;e+=u.slice(f,u.indexOf("(",f))}else{e+=u;for(var c in o.prototype)e+=";"+l+".prototype."+c+"="+o.prototype[c].toString()}else e+=u}else t[l]=o}return[e,t]},Ye=[],kr=function(r){var e=[];for(var t in r)(r[t]instanceof M||r[t]instanceof V||r[t]instanceof le)&&e.push((r[t]=new r[t].constructor(r[t])).buffer);return e},Tn=function(r,e,t,n){var i;if(!Ye[t]){for(var a="",s={},o=r.length-1,l=0;l<o;++l)i=$t(r[l],a,s),a=i[0],s=i[1];Ye[t]=$t(r[o],a,s)}var u=je({},Ye[t][1]);return Er(Ye[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,u,kr(u),n)},Me=function(){return[M,V,le,Fe,Pe,ze,Pt,pn,gn,dn,Oe,J,Je,Q,Ne,Ge,N,Ve,Ee,ge,Mt]},Se=function(){return[M,V,le,Fe,Pe,ze,nt,yt,vn,ce,mn,Ie,Oe,yn,oe,J,re,xe,et,rt,wt,Te,Be,xt,Ge,N,wn,me,Xe,ge]},In=function(){return[St,Ct,S,De,xn]},An=function(){return[Lt,Dn]},Fn=function(){return[Et,S,Dt]},Pn=function(){return[Mn]},ge=function(r){return postMessage(r,[r.buffer])},Mt=function(r){return r&&r.size&&new M(r.size)},Le=function(r,e,t,n,i,a){var s=Tn(t,n,i,function(o,l){s.terminate(),a(o,l)});return s.postMessage([r,e],e.consume?[r.buffer]:[]),function(){s.terminate()}},ee=function(r){return r.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return r.push(e.data[0],e.data[1])}},Ce=function(r,e,t,n,i){var a,s=Tn(r,n,i,function(o,l){o?(s.terminate(),e.ondata.call(e,o)):(l[1]&&s.terminate(),e.ondata.call(e,o,l[0],l[1]))});s.postMessage(t),e.push=function(o,l){if(a)throw"stream finished";if(!e.ondata)throw"no stream handler";s.postMessage([o,a=l],[o.buffer])},e.terminate=function(){s.terminate()}},K=function(r,e){return r[e]|r[e+1]<<8},G=function(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0},ht=function(r,e){return G(r,e)+G(r,e+4)*4294967296},S=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8},St=function(r,e){var t=e.filename;if(r[0]=31,r[1]=139,r[2]=8,r[8]=e.level<2?4:e.level==9?2:0,r[9]=3,e.mtime!=0&&S(r,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){r[3]=8;for(var n=0;n<=t.length;++n)r[n+10]=t.charCodeAt(n)}},Lt=function(r){if(r[0]!=31||r[1]!=139||r[2]!=8)throw"invalid gzip data";var e=r[3],t=10;e&4&&(t+=r[10]|(r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},Dn=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Ct=function(r){return 10+(r.filename&&r.filename.length+1||0)},Et=function(r,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;r[0]=120,r[1]=n<<6|(n?32-2*n:1)},Mn=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function kt(r,e){return!e&&typeof r=="function"&&(e=r,r={}),this.ondata=e,r}var se=function(){function r(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return r.prototype.p=function(e,t){this.ondata(me(e,this.o,0,0,!t),t)},r.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},r}(),Sn=function(){function r(e,t){Ce([Se,function(){return[ee,se]}],this,kt.call(this,e,t),function(n){var i=new se(n.data);onmessage=ee(i)},6)}return r}();function Ln(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Le(r,e,[Se],function(n){return ge(Xe(n.data[0],n.data[1]))},0,t)}function Xe(r,e){return me(r,e||{},0,0)}var _=function(){function r(e){this.s={},this.p=new M(0),this.ondata=e}return r.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new M(t+e.length);n.set(this.p),n.set(e,t),this.p=n},r.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=Ve(this.p,this.o,this.s);this.ondata(N(n,t,this.s.b),this.d),this.o=N(n,this.s.b-32768),this.s.b=this.o.length,this.p=N(this.p,this.s.p/8|0),this.s.p&=7},r.prototype.push=function(e,t){this.e(e),this.c(t)},r}(),Rt=function(){function r(e){this.ondata=e,Ce([Me,function(){return[ee,_]}],this,0,function(){var t=new _;onmessage=ee(t)},7)}return r}();function Bt(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Le(r,e,[Me],function(n){return ge(Ee(n.data[0],Mt(n.data[1])))},1,t)}function Ee(r,e){return Ve(r,e)}var it=function(){function r(e,t){this.c=De(),this.l=0,this.v=1,se.call(this,e,t)}return r.prototype.push=function(e,t){se.prototype.push.call(this,e,t)},r.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=me(e,this.o,this.v&&Ct(this.o),t&&8,!t);this.v&&(St(n,this.o),this.v=0),t&&(S(n,n.length-8,this.c.d()),S(n,n.length-4,this.l)),this.ondata(n,t)},r}(),Qt=function(){function r(e,t){Ce([Se,In,function(){return[ee,se,it]}],this,kt.call(this,e,t),function(n){var i=new it(n.data);onmessage=ee(i)},8)}return r}();function Jt(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Le(r,e,[Se,In,function(){return[at]}],function(n){return ge(at(n.data[0],n.data[1]))},2,t)}function at(r,e){e||(e={});var t=De(),n=r.length;t.p(r);var i=me(r,e,Ct(e),8),a=i.length;return St(i,e),S(i,a-8,t.d()),S(i,a-4,n),i}var st=function(){function r(e){this.v=1,_.call(this,e)}return r.prototype.push=function(e,t){if(_.prototype.e.call(this,e),this.v){var n=this.p.length>3?Lt(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}_.prototype.c.call(this,t)},r}(),Cn=function(){function r(e){this.ondata=e,Ce([Me,An,function(){return[ee,_,st]}],this,0,function(){var t=new st;onmessage=ee(t)},9)}return r}();function En(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Le(r,e,[Me,An,function(){return[ot]}],function(n){return ge(ot(n.data[0]))},3,t)}function ot(r,e){return Ve(r.subarray(Lt(r),-8),e||new M(Dn(r)))}var Tt=function(){function r(e,t){this.c=Dt(),this.v=1,se.call(this,e,t)}return r.prototype.push=function(e,t){se.prototype.push.call(this,e,t)},r.prototype.p=function(e,t){this.c.p(e);var n=me(e,this.o,this.v&&2,t&&4,!t);this.v&&(Et(n,this.o),this.v=0),t&&S(n,n.length-4,this.c.d()),this.ondata(n,t)},r}(),Rr=function(){function r(e,t){Ce([Se,Fn,function(){return[ee,se,Tt]}],this,kt.call(this,e,t),function(n){var i=new Tt(n.data);onmessage=ee(i)},10)}return r}();function Br(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Le(r,e,[Se,Fn,function(){return[It]}],function(n){return ge(It(n.data[0],n.data[1]))},4,t)}function It(r,e){e||(e={});var t=Dt();t.p(r);var n=me(r,e,2,4);return Et(n,e),S(n,n.length-4,t.d()),n}var lt=function(){function r(e){this.v=1,_.call(this,e)}return r.prototype.push=function(e,t){if(_.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}_.prototype.c.call(this,t)},r}(),kn=function(){function r(e){this.ondata=e,Ce([Me,Pn,function(){return[ee,_,lt]}],this,0,function(){var t=new lt;onmessage=ee(t)},11)}return r}();function Rn(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Le(r,e,[Me,Pn,function(){return[be]}],function(n){return ge(be(n.data[0],Mt(n.data[1])))},5,t)}function be(r,e){return Ve((Mn(r),r.subarray(2,-4)),e)}var Bn=function(){function r(e){this.G=st,this.I=_,this.Z=lt,this.ondata=e}return r.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new M(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,a=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(a):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(a):new this.Z(a),this.s.push(this.p,t),this.p=null}}},r}(),zr=function(){function r(e){this.G=Cn,this.I=Rt,this.Z=kn,this.ondata=e}return r.prototype.push=function(e,t){Bn.prototype.push.call(this,e,t)},r}();function Or(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return r[0]==31&&r[1]==139&&r[2]==8?En(r,e,t):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Bt(r,e,t):Rn(r,e,t)}function br(r,e){return r[0]==31&&r[1]==139&&r[2]==8?ot(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Ee(r,e):be(r,e)}var zt=function(r,e,t,n){for(var i in r){var a=r[i],s=e+i;a instanceof M?t[s]=[a,n]:Array.isArray(a)?t[s]=[a[0],je(n,a[1])]:zt(a,s+"/",t,n)}},Nt=typeof TextEncoder<"u"&&new TextEncoder,At=typeof TextDecoder<"u"&&new TextDecoder,zn=0;try{At.decode(oe,{stream:!0}),zn=1}catch{}var On=function(r){for(var e="",t=0;;){var n=r[t++],i=(n>127)+(n>223)+(n>239);if(t+i>r.length)return[e,N(r,t-1)];i?i==3?(n=((n&15)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|r[t++]&63):e+=String.fromCharCode((n&15)<<12|(r[t++]&63)<<6|r[t++]&63):e+=String.fromCharCode(n)}},Ur=function(){function r(e){this.ondata=e,zn?this.t=new TextDecoder:this.p=oe}return r.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new M(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=On(n),a=i[0],s=i[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(a,t)},r}(),Gr=function(){function r(e){this.ondata=e}return r.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(ve(e),this.d=t||!1)},r}();function ve(r,e){if(e){for(var t=new M(r.length),n=0;n<r.length;++n)t[n]=r.charCodeAt(n);return t}if(Nt)return Nt.encode(r);for(var i=r.length,a=new M(r.length+(r.length>>1)),s=0,o=function(f){a[s++]=f},n=0;n<i;++n){if(s+5>a.length){var l=new M(s+8+(i-n<<1));l.set(a),a=l}var u=r.charCodeAt(n);u<128||e?o(u):u<2048?(o(192|u>>6),o(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|r.charCodeAt(++n)&1023,o(240|u>>18),o(128|u>>12&63),o(128|u>>6&63),o(128|u&63)):(o(224|u>>12),o(128|u>>6&63),o(128|u&63))}return N(a,0,s)}function Ot(r,e){if(e){for(var t="",n=0;n<r.length;n+=16384)t+=String.fromCharCode.apply(null,r.subarray(n,n+16384));return t}else{if(At)return At.decode(r);var i=On(r),a=i[0],s=i[1];if(s.length)throw"invalid utf-8 data";return a}}var bn=function(r){return r==1?3:r<6?2:r==9?1:0},Un=function(r,e){return e+30+K(r,e+26)+K(r,e+28)},Gn=function(r,e,t){var n=K(r,e+28),i=Ot(r.subarray(e+46,e+46+n),!(K(r,e+8)&2048)),a=e+46+n,s=G(r,e+20),o=t&&s==4294967295?Vn(r,a):[s,G(r,e+24),G(r,e+42)],l=o[0],u=o[1],f=o[2];return[K(r,e+10),l,u,i,a+K(r,e+30)+K(r,e+32),f]},Vn=function(r,e){for(;K(r,e)!=1;e+=4+K(r,e+2));return[ht(r,e+12),ht(r,e+4),ht(r,e+20)]},he=function(r){var e=0;if(r)for(var t in r){var n=r[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Ae=function(r,e,t,n,i,a,s,o){var l=n.length,u=t.extra,f=o&&o.length,c=he(u);S(r,e,s!=null?33639248:67324752),e+=4,s!=null&&(r[e++]=20,r[e++]=t.os),r[e]=20,e+=2,r[e++]=t.flag<<1|(a==null&&8),r[e++]=i&&8,r[e++]=t.compression&255,r[e++]=t.compression>>8;var h=new Date(t.mtime==null?Date.now():t.mtime),p=h.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(S(r,e,p<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),e+=4,a!=null&&(S(r,e,t.crc),S(r,e+4,a),S(r,e+8,t.size)),S(r,e+12,l),S(r,e+14,c),e+=16,s!=null&&(S(r,e,f),S(r,e+6,t.attrs),S(r,e+10,s),e+=14),r.set(n,e),e+=l,c)for(var v in u){var g=u[v],d=g.length;S(r,e,+v),S(r,e+2,d),r.set(g,e+4),e+=4+d}return f&&(r.set(o,e),e+=f),e},bt=function(r,e,t,n,i){S(r,e,101010256),S(r,e+8,t),S(r,e+10,t),S(r,e+12,n),S(r,e+16,i)},Ue=function(){function r(e){this.filename=e,this.c=De(),this.size=0,this.compression=0}return r.prototype.process=function(e,t){this.ondata(null,e,t)},r.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},r}(),Vr=function(){function r(e,t){var n=this;t||(t={}),Ue.call(this,e),this.d=new se(t,function(i,a){n.ondata(null,i,a)}),this.compression=8,this.flag=bn(t.level)}return r.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},r.prototype.push=function(e,t){Ue.prototype.push.call(this,e,t)},r}(),jr=function(){function r(e,t){var n=this;t||(t={}),Ue.call(this,e),this.d=new Sn(t,function(i,a,s){n.ondata(i,a,s)}),this.compression=8,this.flag=bn(t.level),this.terminate=this.d.terminate}return r.prototype.process=function(e,t){this.d.push(e,t)},r.prototype.push=function(e,t){Ue.prototype.push.call(this,e,t)},r}(),Xr=function(){function r(e){this.ondata=e,this.u=[],this.d=1}return r.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=ve(e.filename),i=n.length,a=e.comment,s=a&&ve(a),o=i!=e.filename.length||s&&a.length!=s.length,l=i+he(e.extra)+30;if(i>65535)throw"filename too long";var u=new M(l);Ae(u,0,e,n,o);var f=[u],c=function(){for(var d=0,x=f;d<x.length;d++){var w=x[d];t.ondata(null,w,!1)}f=[]},h=this.d;this.d=0;var p=this.u.length,v=je(e,{f:n,u:o,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(c(),h){var d=t.u[p+1];d?d.r():t.d=1}h=1}}),g=0;e.ondata=function(d,x,w){if(d)t.ondata(d,x,w),t.terminate();else if(g+=x.length,f.push(x),w){var m=new M(16);S(m,0,134695760),S(m,4,e.crc),S(m,8,g),S(m,12,e.size),f.push(m),v.c=g,v.b=l+g+16,v.crc=e.crc,v.size=e.size,h&&v.r(),h=1}else h&&c()},this.u.push(v)},r.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){e.d&1&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},r.prototype.e=function(){for(var e=0,t=0,n=0,i=0,a=this.u;i<a.length;i++){var s=a[i];n+=46+s.f.length+he(s.extra)+(s.o?s.o.length:0)}for(var o=new M(n+22),l=0,u=this.u;l<u.length;l++){var s=u[l];Ae(o,e,s,s.f,s.u,s.c,t,s.o),e+=46+s.f.length+he(s.extra)+(s.o?s.o.length:0),t+=s.b}bt(o,e,this.u.length,n,t),this.ondata(null,o,!0),this.d=2},r.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},r}();function Hr(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};zt(r,"",n,e);var i=Object.keys(n),a=i.length,s=0,o=0,l=a,u=new Array(a),f=[],c=function(){for(var g=0;g<f.length;++g)f[g]()},h=function(){var g=new M(o+22),d=s,x=o-s;o=0;for(var w=0;w<l;++w){var m=u[w];try{var T=m.c.length;Ae(g,o,m,m.f,m.u,T);var P=30+m.f.length+he(m.extra),A=o+P;g.set(m.c,A),Ae(g,s,m,m.f,m.u,T,o,m.m),s+=16+P+(m.m?m.m.length:0),o=A+T}catch(I){return t(I,null)}}bt(g,s,u.length,x,d),t(null,g)};a||h();for(var p=function(g){var d=i[g],x=n[d],w=x[0],m=x[1],T=De(),P=w.length;T.p(w);var A=ve(d),I=A.length,y=m.comment,B=y&&ve(y),F=B&&B.length,j=he(m.extra),E=m.level==0?0:8,L=function(C,O){if(C)c(),t(C,null);else{var k=O.length;u[g]=je(m,{size:P,crc:T.d(),c:O,f:A,m:B,u:I!=d.length||B&&y.length!=F,compression:E}),s+=30+I+j+k,o+=76+2*(I+j)+(F||0)+k,--a||h()}};if(I>65535&&L("filename too long",null),!E)L(null,w);else if(P<16e4)try{L(null,Xe(w,m))}catch(C){L(C,null)}else f.push(Ln(w,m,L))},v=0;v<l;++v)p(v);return c}function Zr(r,e){e||(e={});var t={},n=[];zt(r,"",t,e);var i=0,a=0;for(var s in t){var o=t[s],l=o[0],u=o[1],f=u.level==0?0:8,c=ve(s),h=c.length,p=u.comment,v=p&&ve(p),g=v&&v.length,d=he(u.extra);if(h>65535)throw"filename too long";var x=f?Xe(l,u):l,w=x.length,m=De();m.p(l),n.push(je(u,{size:l.length,crc:m.d(),c:x,f:c,m:v,u:h!=s.length||v&&p.length!=g,o:i,compression:f})),i+=30+h+d+w,a+=76+2*(h+d)+(g||0)+w}for(var T=new M(a+22),P=i,A=a-i,I=0;I<n.length;++I){var c=n[I];Ae(T,c.o,c,c.f,c.u,c.c.length);var y=30+c.f.length+he(c.extra);T.set(c.c,c.o+y),Ae(T,i,c,c.f,c.u,c.c.length,c.o,c.m),i+=16+y+(c.m?c.m.length:0)}return bt(T,i,n.length,A,P),T}var jn=function(){function r(){}return r.prototype.push=function(e,t){this.ondata(null,e,t)},r.compression=0,r}(),Kr=function(){function r(){var e=this;this.i=new _(function(t,n){e.ondata(null,t,n)})}return r.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},r.compression=8,r}(),Wr=function(){function r(e,t){var n=this;t<32e4?this.i=new _(function(i,a){n.ondata(null,i,a)}):(this.i=new Rt(function(i,a,s){n.ondata(i,a,s)}),this.terminate=this.i.terminate)}return r.prototype.push=function(e,t){this.i.terminate&&(e=N(e,0)),this.i.push(e,t)},r.compression=8,r}(),Yr=function(){function r(e){this.onfile=e,this.k=[],this.o={0:jn},this.p=oe}return r.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),a=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(a,!this.c):this.k[0].push(a),e=e.subarray(i),e.length)return this.push(e,t)}else{var s=0,o=0,l=void 0,u=void 0;this.p.length?e.length?(u=new M(this.p.length+e.length),u.set(this.p),u.set(e,this.p.length)):u=this.p:u=e;for(var f=u.length,c=this.c,h=c&&this.d,p=function(){var x,w=G(u,o);if(w==67324752){s=1,l=o,v.d=null,v.c=0;var m=K(u,o+6),T=K(u,o+8),P=m&2048,A=m&8,I=K(u,o+26),y=K(u,o+28);if(f>o+30+I+y){var B=[];v.k.unshift(B),s=2;var F=G(u,o+18),j=G(u,o+22),E=Ot(u.subarray(o+30,o+=30+I),!P);F==4294967295?(x=A?[-2]:Vn(u,o),F=x[0],j=x[1]):A&&(F=-1),o+=y,v.c=F;var L,C={name:E,compression:T,start:function(){if(!C.ondata)throw"no callback";if(!F)C.ondata(null,oe,!0);else{var O=n.o[T];if(!O)throw"unknown compression type "+T;L=F<0?new O(E):new O(E,F,j),L.ondata=function(W,$,Z){C.ondata(W,$,Z)};for(var k=0,z=B;k<z.length;k++){var H=z[k];L.push(H,!1)}n.k[0]==B&&n.c?n.d=L:L.push(oe,!0)}},terminate:function(){L&&L.terminate&&L.terminate()}};F>=0&&(C.size=F,C.originalSize=j),v.onfile(C)}return"break"}else if(c){if(w==134695760)return l=o+=12+(c==-2&&8),s=3,v.c=0,"break";if(w==33639248)return l=o-=4,s=3,v.c=0,"break"}},v=this;o<f-4;++o){var g=p();if(g==="break")break}if(this.p=oe,c<0){var d=s?u.subarray(0,l-12-(c==-2&&8)-(G(u,l-16)==134695760&&4)):u.subarray(0,o);h?h.push(d,!!s):this.k[+(s==2)].push(d)}if(s&2)return this.push(u.subarray(o),t);this.p=u.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},r.prototype.register=function(e){this.o[e.compression]=e},r}();function qr(r,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var h=0;h<t.length;++h)t[h]()},i={},a=r.length-22;G(r,a)!=101010256;--a)if(!a||r.length-a>65558){e("invalid zip file",null);return}var s=K(r,a+8);s||e(null,{});var o=s,l=G(r,a+16),u=l==4294967295;if(u){if(a=G(r,a-12),G(r,a)!=101075792){e("invalid zip file",null);return}o=s=G(r,a+32),l=G(r,a+48)}for(var f=function(h){var p=Gn(r,l,u),v=p[0],g=p[1],d=p[2],x=p[3],w=p[4],m=p[5],T=Un(r,m);l=w;var P=function(I,y){I?(n(),e(I,null)):(i[x]=y,--s||e(null,i))};if(!v)P(null,N(r,T,T+g));else if(v==8){var A=r.subarray(T,T+g);if(g<32e4)try{P(null,Ee(A,new M(d)))}catch(I){P(I,null)}else t.push(Bt(A,{size:d},P))}else P("unknown compression type "+v,null)},c=0;c<o;++c)f();return n}function _r(r){for(var e={},t=r.length-22;G(r,t)!=101010256;--t)if(!t||r.length-t>65558)throw"invalid zip file";var n=K(r,t+8);if(!n)return{};var i=G(r,t+16),a=i==4294967295;if(a){if(t=G(r,t-12),G(r,t)!=101075792)throw"invalid zip file";n=G(r,t+32),i=G(r,t+48)}for(var s=0;s<n;++s){var o=Gn(r,i,a),l=o[0],u=o[1],f=o[2],c=o[3],h=o[4],p=o[5],v=Un(r,p);if(i=h,!l)e[c]=N(r,v,v+u);else if(l==8)e[c]=Ee(r.subarray(v,v+u),new M(f));else throw"unknown compression type "+l}return e}const $r=Object.freeze(Object.defineProperty({__proto__:null,AsyncCompress:Qt,AsyncDecompress:zr,AsyncDeflate:Sn,AsyncGunzip:Cn,AsyncGzip:Qt,AsyncInflate:Rt,AsyncUnzipInflate:Wr,AsyncUnzlib:kn,AsyncZipDeflate:jr,AsyncZlib:Rr,Compress:it,DecodeUTF8:Ur,Decompress:Bn,Deflate:se,EncodeUTF8:Gr,Gunzip:st,Gzip:it,Inflate:_,Unzip:Yr,UnzipInflate:Kr,UnzipPassThrough:jn,Unzlib:lt,Zip:Xr,ZipDeflate:Vr,ZipPassThrough:Ue,Zlib:Tt,compress:Jt,compressSync:at,decompress:Or,decompressSync:br,deflate:Ln,deflateSync:Xe,gunzip:En,gunzipSync:ot,gzip:Jt,gzipSync:at,inflate:Bt,inflateSync:Ee,strFromU8:Ot,strToU8:ve,unzip:qr,unzipSync:_r,unzlib:Rn,unzlibSync:be,zip:Hr,zipSync:Zr,zlib:Br,zlibSync:It},Symbol.toStringTag,{value:"Module"}));function Xn(r,e,t){const n=t.length-r-1;if(e>=t[n])return n-1;if(e<=t[r])return r;let i=r,a=n,s=Math.floor((i+a)/2);for(;e<t[s]||e>=t[s+1];)e<t[s]?a=s:i=s,s=Math.floor((i+a)/2);return s}function Qr(r,e,t,n){const i=[],a=[],s=[];i[0]=1;for(let o=1;o<=t;++o){a[o]=e-n[r+1-o],s[o]=n[r+o]-e;let l=0;for(let u=0;u<o;++u){const f=s[u+1],c=a[o-u],h=i[u]/(f+c);i[u]=l+f*h,l=c*h}i[o]=l}return i}function Jr(r,e,t,n){const i=Xn(r,n,e),a=Qr(i,n,r,e),s=new ct(0,0,0,0);for(let o=0;o<=r;++o){const l=t[i-r+o],u=a[o],f=l.w*u;s.x+=l.x*f,s.y+=l.y*f,s.z+=l.z*f,s.w+=l.w*u}return s}function Nr(r,e,t,n,i){const a=[];for(let c=0;c<=t;++c)a[c]=0;const s=[];for(let c=0;c<=n;++c)s[c]=a.slice(0);const o=[];for(let c=0;c<=t;++c)o[c]=a.slice(0);o[0][0]=1;const l=a.slice(0),u=a.slice(0);for(let c=1;c<=t;++c){l[c]=e-i[r+1-c],u[c]=i[r+c]-e;let h=0;for(let p=0;p<c;++p){const v=u[p+1],g=l[c-p];o[c][p]=v+g;const d=o[p][c-1]/o[c][p];o[p][c]=h+v*d,h=g*d}o[c][c]=h}for(let c=0;c<=t;++c)s[0][c]=o[c][t];for(let c=0;c<=t;++c){let h=0,p=1;const v=[];for(let g=0;g<=t;++g)v[g]=a.slice(0);v[0][0]=1;for(let g=1;g<=n;++g){let d=0;const x=c-g,w=t-g;c>=g&&(v[p][0]=v[h][0]/o[w+1][x],d=v[p][0]*o[x][w]);const m=x>=-1?1:-x,T=c-1<=w?g-1:t-c;for(let A=m;A<=T;++A)v[p][A]=(v[h][A]-v[h][A-1])/o[w+1][x+A],d+=v[p][A]*o[x+A][w];c<=w&&(v[p][g]=-v[h][g-1]/o[w+1][c],d+=v[p][g]*o[c][w]),s[g][c]=d;const P=h;h=p,p=P}}let f=t;for(let c=1;c<=n;++c){for(let h=0;h<=t;++h)s[c][h]*=f;f*=t-c}return s}function ei(r,e,t,n,i){const a=i<r?i:r,s=[],o=Xn(r,n,e),l=Nr(o,n,r,a,e),u=[];for(let f=0;f<t.length;++f){const c=t[f].clone(),h=c.w;c.x*=h,c.y*=h,c.z*=h,u[f]=c}for(let f=0;f<=a;++f){const c=u[o-r].clone().multiplyScalar(l[f][0]);for(let h=1;h<=r;++h)c.add(u[o-r+h].clone().multiplyScalar(l[f][h]));s[f]=c}for(let f=a+1;f<=i+1;++f)s[f]=new ct(0,0,0);return s}function ti(r,e){let t=1;for(let i=2;i<=r;++i)t*=i;let n=1;for(let i=2;i<=e;++i)n*=i;for(let i=2;i<=r-e;++i)n*=i;return t/n}function ni(r){const e=r.length,t=[],n=[];for(let a=0;a<e;++a){const s=r[a];t[a]=new pe(s.x,s.y,s.z),n[a]=s.w}const i=[];for(let a=0;a<e;++a){const s=t[a].clone();for(let o=1;o<=a;++o)s.sub(i[a-o].clone().multiplyScalar(ti(a,o)*n[o]));i[a]=s.divideScalar(n[0])}return i}function ri(r,e,t,n,i){const a=ei(r,e,t,n,i);return ni(a)}class en extends or{constructor(e,t,n,i,a){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=a||this.knots.length-1;for(let s=0;s<n.length;++s){const o=n[s];this.controlPoints[s]=new ct(o.x,o.y,o.z,o.w)}}getPoint(e,t=new pe){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=Jr(this.degree,this.knots,this.controlPoints,i);return a.w!==1&&a.divideScalar(a.w),n.set(a.x,a.y,a.z)}getTangent(e,t=new pe){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=ri(this.degree,this.knots,this.controlPoints,i,1);return n.copy(a[1]).normalize(),n}}let D,U,q;class ii extends lr{constructor(e){super(e)}load(e,t,n,i){const a=this,s=a.path===""?Ft.extractUrlBase(e):a.path,o=new cr(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(l){try{t(a.parse(l,s))}catch(u){i?i(u):console.error(u),a.manager.itemError(e)}},n,i)}parse(e,t){if(ui(e))D=new ci().parse(e);else{const i=Wn(e);if(!fi(i))throw new Error("THREE.FBXLoader: Unknown format.");if(nn(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+nn(i));D=new li().parse(i)}const n=new gt(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new ai(n,this.manager).parse(D)}}class ai{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){U=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),a=new si().parse(i);return this.parseScene(i,a,n),q}parseConnections(){const e=new Map;return"Connections"in D&&D.Connections.connections.forEach(function(n){const i=n[0],a=n[1],s=n[2];e.has(i)||e.set(i,{parents:[],children:[]});const o={ID:a,relationship:s};e.get(i).parents.push(o),e.has(a)||e.set(a,{parents:[],children:[]});const l={ID:i,relationship:s};e.get(a).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in D.Objects){const n=D.Objects.Video;for(const i in n){const a=n[i],s=parseInt(i);if(e[s]=a.RelativeFilename||a.Filename,"Content"in a){const o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,l=typeof a.Content=="string"&&a.Content!=="";if(o||l){const u=this.parseImage(n[i]);t[a.RelativeFilename||a.Filename]=u}}}}for(const n in e){const i=e[n];t[i]!==void 0?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let a;switch(i){case"bmp":a="image/bmp";break;case"jpg":case"jpeg":a="image/jpeg";break;case"png":a="image/png";break;case"tif":a="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),a="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof t=="string")return"data:"+a+";base64,"+t;{const s=new Uint8Array(t);return window.URL.createObjectURL(new Blob([s],{type:a}))}}parseTextures(e){const t=new Map;if("Texture"in D.Objects){const n=D.Objects.Texture;for(const i in n){const a=this.parseTexture(n[i],e);t.set(parseInt(i),a)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,a=e.WrapModeV,s=i!==void 0?i.value:0,o=a!==void 0?a.value:0;if(n.wrapS=s===0?Xt:Ht,n.wrapT=o===0?Xt:Ht,"Scaling"in e){const l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;n.offset.x=l[0],n.offset.y=l[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,a=U.get(e.id).children;a!==void 0&&a.length>0&&t[a[0].ID]!==void 0&&(n=t[a[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let s;const o=e.FileName.slice(-3).toLowerCase();if(o==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new Zt):(l.setPath(this.textureLoader.path),s=l.load(n))}else o==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new Zt):s=this.textureLoader.load(n);return this.textureLoader.setPath(i),s}parseMaterials(e){const t=new Map;if("Material"in D.Objects){const n=D.Objects.Material;for(const i in n){const a=this.parseMaterial(n[i],e);a!==null&&t.set(parseInt(i),a)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let a=e.ShadingModel;if(typeof a=="object"&&(a=a.value),!U.has(n))return null;const s=this.parseParameters(e,t,n);let o;switch(a.toLowerCase()){case"phong":o=new $e;break;case"lambert":o=new an;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new $e;break}return o.setValues(s),o.name=i,o}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new ie().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new ie().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new ie().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new ie().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new ie().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new ie().fromArray(e.SpecularColor.value));const a=this;return U.get(n).children.forEach(function(s){const o=s.relationship;switch(o){case"Bump":i.bumpMap=a.getTexture(t,s.ID);break;case"Maya|TEX_ao_map":i.aoMap=a.getTexture(t,s.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=a.getTexture(t,s.ID),i.map!==void 0&&(i.map.encoding=Ze);break;case"DisplacementColor":i.displacementMap=a.getTexture(t,s.ID);break;case"EmissiveColor":i.emissiveMap=a.getTexture(t,s.ID),i.emissiveMap!==void 0&&(i.emissiveMap.encoding=Ze);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=a.getTexture(t,s.ID);break;case"ReflectionColor":i.envMap=a.getTexture(t,s.ID),i.envMap!==void 0&&(i.envMap.mapping=ur,i.envMap.encoding=Ze);break;case"SpecularColor":i.specularMap=a.getTexture(t,s.ID),i.specularMap!==void 0&&(i.specularMap.encoding=Ze);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=a.getTexture(t,s.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",o);break}}),i}getTexture(e,t){return"LayeredTexture"in D.Objects&&t in D.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=U.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in D.Objects){const n=D.Objects.Deformer;for(const i in n){const a=n[i],s=U.get(parseInt(i));if(a.attrType==="Skin"){const o=this.parseSkeleton(s,n);o.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=s.parents[0].ID,e[i]=o}else if(a.attrType==="BlendShape"){const o={id:i};o.rawTargets=this.parseMorphTargets(s,n),o.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(i){const a=t[i.ID];if(a.attrType!=="Cluster")return;const s={ID:i.ID,indices:[],weights:[],transformLink:new b().fromArray(a.TransformLink.a)};"Indexes"in a&&(s.indices=a.Indexes.a,s.weights=a.Weights.a),n.push(s)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const a=e.children[i],s=t[a.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if(s.attrType!=="BlendShapeChannel")return;o.geoID=U.get(parseInt(a.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(o)}return n}parseScene(e,t,n){q=new mt;const i=this.parseModels(e.skeletons,t,n),a=D.Objects.Model,s=this;i.forEach(function(l){const u=a[l.ID];s.setLookAtProperties(l,u),U.get(l.ID).parents.forEach(function(c){const h=i.get(c.ID);h!==void 0&&h.add(l)}),l.parent===null&&q.add(l)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),q.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const u=Zn(l.userData.transformData);l.applyMatrix4(u),l.updateWorldMatrix()}});const o=new oi().parse();q.children.length===1&&q.children[0].isGroup&&(q.children[0].animations=o,q=q.children[0]),q.animations=o}parseModels(e,t,n){const i=new Map,a=D.Objects.Model;for(const s in a){const o=parseInt(s),l=a[s],u=U.get(o);let f=this.buildSkeleton(u,e,o,l.attrName);if(!f){switch(l.attrType){case"Camera":f=this.createCamera(u);break;case"Light":f=this.createLight(u);break;case"Mesh":f=this.createMesh(u,t,n);break;case"NurbsCurve":f=this.createCurve(u,t);break;case"LimbNode":case"Root":f=new Kt;break;case"Null":default:f=new mt;break}f.name=l.attrName?tt.sanitizeNodeName(l.attrName):"",f.ID=o}this.getTransformData(f,l),i.set(o,f)}return i}buildSkeleton(e,t,n,i){let a=null;return e.parents.forEach(function(s){for(const o in t){const l=t[o];l.rawBones.forEach(function(u,f){if(u.ID===s.ID){const c=a;a=new Kt,a.matrixWorld.copy(u.transformLink),a.name=i?tt.sanitizeNodeName(i):"",a.ID=n,l.bones[f]=a,c!==null&&a.add(c)}})}}),a}createCamera(e){let t,n;if(e.children.forEach(function(i){const a=D.Objects.NodeAttribute[i.ID];a!==void 0&&(n=a)}),n===void 0)t=new ft;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let a=1;n.NearPlane!==void 0&&(a=n.NearPlane.value/1e3);let s=1e3;n.FarPlane!==void 0&&(s=n.FarPlane.value/1e3);let o=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(o=n.AspectWidth.value,l=n.AspectHeight.value);const u=o/l;let f=45;n.FieldOfView!==void 0&&(f=n.FieldOfView.value);const c=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new hr(f,u,a,s),c!==null&&t.setFocalLength(c);break;case 1:t=new fr(-o/2,o/2,l/2,-l/2,a,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new ft;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(i){const a=D.Objects.NodeAttribute[i.ID];a!==void 0&&(n=a)}),n===void 0)t=new ft;else{let i;n.LightType===void 0?i=0:i=n.LightType.value;let a=16777215;n.Color!==void 0&&(a=new ie().fromArray(n.Color.value));let s=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(s=0);let o=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?o=0:o=n.FarAttenuationEnd.value);const l=1;switch(i){case 0:t=new Wt(a,s,o,l);break;case 1:t=new on(a,s);break;case 2:let u=Math.PI/3;n.InnerAngle!==void 0&&(u=ae.degToRad(n.InnerAngle.value));let f=0;n.OuterAngle!==void 0&&(f=ae.degToRad(n.OuterAngle.value),f=Math.max(f,1)),t=new sn(a,s,o,u,f,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Wt(a,s);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,a=null,s=null;const o=[];return e.children.forEach(function(l){t.has(l.ID)&&(a=t.get(l.ID)),n.has(l.ID)&&o.push(n.get(l.ID))}),o.length>1?s=o:o.length>0?s=o[0]:(s=new $e({color:13421772}),o.push(s)),"color"in a.attributes&&o.forEach(function(l){l.vertexColors=!0}),a.FBX_Deformer?(i=new pr(a,s),i.normalizeSkinWeights()):i=new Qe(a,s),i}createCurve(e,t){const n=e.children.reduce(function(a,s){return t.has(s.ID)&&(a=t.get(s.ID)),a},null),i=new vr({color:3342591,linewidth:1});return new gr(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=Kn(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&U.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const a=D.Objects.Model[i.ID];if("Lcl_Translation"in a){const s=a.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(s),q.add(e.target)):e.lookAt(new pe().fromArray(s))}}})}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const a in e){const s=e[a];U.get(parseInt(s.ID)).parents.forEach(function(l){if(t.has(l.ID)){const u=l.ID;U.get(u).parents.forEach(function(c){n.has(c.ID)&&n.get(c.ID).bind(new mr(s.bones),i[c.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in D.Objects){const t=D.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(a){e[a.Node]=new b().fromArray(a.Matrix.a)}):e[i.Node]=new b().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in D&&"AmbientColor"in D.GlobalSettings){const e=D.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(t!==0||n!==0||i!==0){const a=new ie(t,n,i);q.add(new ln(a,1))}}}}class si{parse(e){const t=new Map;if("Geometry"in D.Objects){const n=D.Objects.Geometry;for(const i in n){const a=U.get(parseInt(i)),s=this.parseGeometry(a,n[i],e);t.set(parseInt(i),s)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,a=[],s=e.parents.map(function(c){return D.Objects.Model[c.ID]});if(s.length===0)return;const o=e.children.reduce(function(c,h){return i[h.ID]!==void 0&&(c=i[h.ID]),c},null);e.children.forEach(function(c){n.morphTargets[c.ID]!==void 0&&a.push(n.morphTargets[c.ID])});const l=s[0],u={};"RotationOrder"in l&&(u.eulerOrder=Kn(l.RotationOrder.value)),"InheritType"in l&&(u.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(u.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(u.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(u.scale=l.GeometricScaling.value);const f=Zn(u);return this.genGeometry(t,o,a,f)}genGeometry(e,t,n,i){const a=new Ke;e.attrName&&(a.name=e.attrName);const s=this.parseGeoNode(e,t),o=this.genBuffers(s),l=new ye(o.vertex,3);if(l.applyMatrix4(i),a.setAttribute("position",l),o.colors.length>0&&a.setAttribute("color",new ye(o.colors,3)),t&&(a.setAttribute("skinIndex",new dr(o.weightsIndices,4)),a.setAttribute("skinWeight",new ye(o.vertexWeights,4)),a.FBX_Deformer=t),o.normal.length>0){const u=new yr().getNormalMatrix(i),f=new ye(o.normal,3);f.applyNormalMatrix(u),a.setAttribute("normal",f)}if(o.uvs.forEach(function(u,f){let c="uv"+(f+1).toString();f===0&&(c="uv"),a.setAttribute(c,new ye(o.uvs[f],2))}),s.material&&s.material.mappingType!=="AllSame"){let u=o.materialIndex[0],f=0;if(o.materialIndex.forEach(function(c,h){c!==u&&(a.addGroup(f,h-f,u),u=c,f=h)}),a.groups.length>0){const c=a.groups[a.groups.length-1],h=c.start+c.count;h!==o.materialIndex.length&&a.addGroup(h,o.materialIndex.length-h,u)}a.groups.length===0&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,e,n,i),a}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(i,a){i.indices.forEach(function(s,o){n.weightTable[s]===void 0&&(n.weightTable[s]=[]),n.weightTable[s].push({id:a,weight:i.weights[o]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,a=!1,s=[],o=[],l=[],u=[],f=[],c=[];const h=this;return e.vertexIndices.forEach(function(p,v){let g,d=!1;p<0&&(p=p^-1,d=!0);let x=[],w=[];if(s.push(p*3,p*3+1,p*3+2),e.color){const m=qe(v,n,p,e.color);l.push(m[0],m[1],m[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(m){w.push(m.weight),x.push(m.id)}),w.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);const m=[0,0,0,0],T=[0,0,0,0];w.forEach(function(P,A){let I=P,y=x[A];T.forEach(function(B,F,j){if(I>B){j[F]=I,I=B;const E=m[F];m[F]=y,y=E}})}),x=m,w=T}for(;w.length<4;)w.push(0),x.push(0);for(let m=0;m<4;++m)f.push(w[m]),c.push(x[m])}if(e.normal){const m=qe(v,n,p,e.normal);o.push(m[0],m[1],m[2])}e.material&&e.material.mappingType!=="AllSame"&&(g=qe(v,n,p,e.material)[0]),e.uv&&e.uv.forEach(function(m,T){const P=qe(v,n,p,m);u[T]===void 0&&(u[T]=[]),u[T].push(P[0]),u[T].push(P[1])}),i++,d&&(h.genFace(t,e,s,g,o,l,u,f,c,i),n++,i=0,s=[],o=[],l=[],u=[],f=[],c=[])}),t}genFace(e,t,n,i,a,s,o,l,u,f){for(let c=2;c<f;c++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(c-1)*3]]),e.vertex.push(t.vertexPositions[n[(c-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(c-1)*3+2]]),e.vertex.push(t.vertexPositions[n[c*3]]),e.vertex.push(t.vertexPositions[n[c*3+1]]),e.vertex.push(t.vertexPositions[n[c*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(c-1)*4]),e.vertexWeights.push(l[(c-1)*4+1]),e.vertexWeights.push(l[(c-1)*4+2]),e.vertexWeights.push(l[(c-1)*4+3]),e.vertexWeights.push(l[c*4]),e.vertexWeights.push(l[c*4+1]),e.vertexWeights.push(l[c*4+2]),e.vertexWeights.push(l[c*4+3]),e.weightsIndices.push(u[0]),e.weightsIndices.push(u[1]),e.weightsIndices.push(u[2]),e.weightsIndices.push(u[3]),e.weightsIndices.push(u[(c-1)*4]),e.weightsIndices.push(u[(c-1)*4+1]),e.weightsIndices.push(u[(c-1)*4+2]),e.weightsIndices.push(u[(c-1)*4+3]),e.weightsIndices.push(u[c*4]),e.weightsIndices.push(u[c*4+1]),e.weightsIndices.push(u[c*4+2]),e.weightsIndices.push(u[c*4+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[(c-1)*3]),e.colors.push(s[(c-1)*3+1]),e.colors.push(s[(c-1)*3+2]),e.colors.push(s[c*3]),e.colors.push(s[c*3+1]),e.colors.push(s[c*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(a[0]),e.normal.push(a[1]),e.normal.push(a[2]),e.normal.push(a[(c-1)*3]),e.normal.push(a[(c-1)*3+1]),e.normal.push(a[(c-1)*3+2]),e.normal.push(a[c*3]),e.normal.push(a[c*3+1]),e.normal.push(a[c*3+2])),t.uv&&t.uv.forEach(function(h,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(o[p][0]),e.uvs[p].push(o[p][1]),e.uvs[p].push(o[p][(c-1)*2]),e.uvs[p].push(o[p][(c-1)*2+1]),e.uvs[p].push(o[p][c*2]),e.uvs[p].push(o[p][c*2+1])})}addMorphTargets(e,t,n,i){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const a=this;n.forEach(function(s){s.rawTargets.forEach(function(o){const l=D.Objects.Geometry[o.geoID];l!==void 0&&a.genMorphGeometry(e,t,l,i,o.name)})})}genMorphGeometry(e,t,n,i,a){const s=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],o=n.Vertices!==void 0?n.Vertices.a:[],l=n.Indexes!==void 0?n.Indexes.a:[],u=e.attributes.position.count*3,f=new Float32Array(u);for(let v=0;v<l.length;v++){const g=l[v]*3;f[g]=o[v*3],f[g+1]=o[v*3+1],f[g+2]=o[v*3+2]}const c={vertexIndices:s,vertexPositions:f},h=this.genBuffers(c),p=new ye(h.vertex,3);p.name=a||n.attrName,p.applyMatrix4(i),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let a=[];return n==="IndexToDirect"&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:a,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let a=[];return n==="IndexToDirect"&&(a=e.UVIndex.a),{dataSize:2,buffer:i,indices:a,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let a=[];return n==="IndexToDirect"&&(a=e.ColorIndex.a),{dataSize:4,buffer:i,indices:a,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,a=[];for(let s=0;s<i.length;++s)a.push(s);return{dataSize:1,buffer:i,indices:a,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(en===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Ke;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Ke;const n=t-1,i=e.KnotVector.a,a=[],s=e.Points.a;for(let c=0,h=s.length;c<h;c+=4)a.push(new ct().fromArray(s,c));let o,l;if(e.Form==="Closed")a.push(a[0]);else if(e.Form==="Periodic"){o=n,l=i.length-1-o;for(let c=0;c<n;++c)a.push(a[c])}const f=new en(n,i,a,o,l).getPoints(a.length*12);return new Ke().setFromPoints(f)}}class oi{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const i=t[n],a=this.addClip(i);e.push(a)}return e}parseClips(){if(D.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=D.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const a={id:i.id,attr:i.attrName,curves:{}};t.set(a.id,a)}}return t}parseAnimationCurves(e){const t=D.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(hi),values:t[n].KeyValueFloat.a},a=U.get(i.id);if(a!==void 0){const s=a.parents[0].ID,o=a.parents[0].relationship;o.match(/X/)?e.get(s).curves.x=i:o.match(/Y/)?e.get(s).curves.y=i:o.match(/Z/)?e.get(s).curves.z=i:o.match(/d|DeformPercent/)&&e.has(s)&&(e.get(s).curves.morph=i)}}}parseAnimationLayers(e){const t=D.Objects.AnimationLayer,n=new Map;for(const i in t){const a=[],s=U.get(parseInt(i));s!==void 0&&(s.children.forEach(function(l,u){if(e.has(l.ID)){const f=e.get(l.ID);if(f.curves.x!==void 0||f.curves.y!==void 0||f.curves.z!==void 0){if(a[u]===void 0){const c=U.get(l.ID).parents.filter(function(h){return h.relationship!==void 0})[0].ID;if(c!==void 0){const h=D.Objects.Model[c.toString()];if(h===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:h.attrName?tt.sanitizeNodeName(h.attrName):"",ID:h.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};q.traverse(function(v){v.ID===h.id&&(p.transform=v.matrix,v.userData.transformData&&(p.eulerOrder=v.userData.transformData.eulerOrder))}),p.transform||(p.transform=new b),"PreRotation"in h&&(p.preRotation=h.PreRotation.value),"PostRotation"in h&&(p.postRotation=h.PostRotation.value),a[u]=p}}a[u]&&(a[u][f.attr]=f)}else if(f.curves.morph!==void 0){if(a[u]===void 0){const c=U.get(l.ID).parents.filter(function(x){return x.relationship!==void 0})[0].ID,h=U.get(c).parents[0].ID,p=U.get(h).parents[0].ID,v=U.get(p).parents[0].ID,g=D.Objects.Model[v],d={modelName:g.attrName?tt.sanitizeNodeName(g.attrName):"",morphName:D.Objects.Deformer[c].attrName};a[u]=d}a[u][f.attr]=f}}}),n.set(parseInt(i),a))}return n}parseAnimStacks(e){const t=D.Objects.AnimationStack,n={};for(const i in t){const a=U.get(parseInt(i)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(a[0].ID);n[i]={name:t[i].attrName,layer:s}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(i){t=t.concat(n.generateTracks(i))}),new wr(e.name,-1,t)}generateTracks(e){const t=[];let n=new pe,i=new We,a=new pe;if(e.transform&&e.transform.decompose(n,i,a),n=n.toArray(),i=new Re().setFromQuaternion(i,e.eulerOrder).toArray(),a=a.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");s!==void 0&&t.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const s=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&t.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");s!==void 0&&t.push(s)}if(e.DeformPercent!==void 0){const s=this.generateMorphTrack(e);s!==void 0&&t.push(s)}return t}generateVectorTrack(e,t,n,i){const a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,n);return new xr(e+"."+i,a,s)}generateRotationTrack(e,t,n,i,a,s){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(ae.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(ae.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(ae.degToRad));const o=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(o,t,n);i!==void 0&&(i=i.map(ae.degToRad),i.push(s),i=new Re().fromArray(i),i=new We().setFromEuler(i)),a!==void 0&&(a=a.map(ae.degToRad),a.push(s),a=new Re().fromArray(a),a=new We().setFromEuler(a).invert());const u=new We,f=new Re,c=[];for(let h=0;h<l.length;h+=3)f.set(l[h],l[h+1],l[h+2],s),u.setFromEuler(f),i!==void 0&&u.premultiply(i),a!==void 0&&u.multiply(a),u.toArray(c,h/3*4);return new Tr(e+".quaternion",o,c)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(a){return a/100}),i=q.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ir(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,i){return n-i}),t.length>1){let n=1,i=t[0];for(let a=1;a<t.length;a++){const s=t[a];s!==i&&(t[n]=s,i=s,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const i=n,a=[];let s=-1,o=-1,l=-1;return e.forEach(function(u){if(t.x&&(s=t.x.times.indexOf(u)),t.y&&(o=t.y.times.indexOf(u)),t.z&&(l=t.z.times.indexOf(u)),s!==-1){const f=t.x.values[s];a.push(f),i[0]=f}else a.push(i[0]);if(o!==-1){const f=t.y.values[o];a.push(f),i[1]=f}else a.push(i[1]);if(l!==-1){const f=t.z.values[l];a.push(f),i[2]=f}else a.push(i[2])}),a}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,a=Math.abs(i);if(a>=180){const s=a/180,o=i/s;let l=n+o;const u=e.times[t-1],c=(e.times[t]-u)/s;let h=u+c;const p=[],v=[];for(;h<e.times[t];)p.push(h),h+=c,v.push(l),l+=o;e.times=rn(e.times,t,p),e.values=rn(e.values,t,v)}}}}class li{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Hn,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(i,a){const s=i.match(/^[\s\t]*;/),o=i.match(/^[\s\t]*$/);if(s||o)return;const l=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),u=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=i.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(i,l):u?t.parseNodeProperty(i,u,n[++a]):f?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:n},s=this.parseNodeAttr(i),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,a):n in o?(n==="PoseNode"?o.PoseNode.push(a):o[n].id!==void 0&&(o[n]={},o[n][o[n].id]=o[n]),s.id!==""&&(o[n][s.id]=a)):typeof s.id=="number"?(o[n]={},o[n][s.id]=a):n!=="Properties70"&&(n==="PoseNode"?o[n]=[a]:o[n]=a),typeof s.id=="number"&&(a.id=s.id),s.name!==""&&(a.attrName=s.name),s.type!==""&&(a.attrType=s.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&a===","&&(a=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if(s.name==="Properties70"){this.parseNodeSpecialProperty(e,i,a);return}if(i==="C"){const l=a.split(",").slice(1),u=parseInt(l[0]),f=parseInt(l[1]);let c=a.split(",").slice(3);c=c.map(function(h){return h.trim().replace(/^"/,"")}),i="connections",a=[u,f],vi(a,c),s[i]===void 0&&(s[i]=[])}i==="Node"&&(s.id=a),i in s&&Array.isArray(s[i])?s[i].push(a):i!=="a"?s[i]=a:s.a=a,this.setCurrentProp(s,i),i==="a"&&a.slice(-1)!==","&&(s.a=vt(a))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=vt(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=i[0],s=i[1],o=i[2],l=i[3];let u=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=vt(u);break}this.getPrevNode()[a]={type:s,type2:o,flag:l,value:u},this.setCurrentProp(this.getPrevNode(),a)}}class ci{parse(e){const t=new tn(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new Hn;for(;!this.endOfContent(t);){const a=this.parseNode(t,n);a!==null&&i.add(a.name,a)}return i}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),o=e.getString(s);if(i===0)return null;const l=[];for(let h=0;h<a;h++)l.push(this.parseProperty(e));const u=l.length>0?l[0]:"",f=l.length>1?l[1]:"",c=l.length>2?l[2]:"";for(n.singleProperty=a===1&&e.getOffset()===i;i>e.getOffset();){const h=this.parseNode(e,t);h!==null&&this.parseSubNode(o,n,h)}return n.propertyList=l,typeof u=="number"&&(n.id=u),f!==""&&(n.attrName=f),c!==""&&(n.attrType=c),o!==""&&(n.name=o),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if(e==="Connections"&&n.name==="C"){const i=[];n.propertyList.forEach(function(a,s){s!==0&&i.push(a)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(a){t[a]=n[a]});else if(e==="Properties70"&&n.name==="P"){let i=n.propertyList[0],a=n.propertyList[1];const s=n.propertyList[2],o=n.propertyList[3];let l;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),a==="Color"||a==="ColorRGB"||a==="Vector"||a==="Vector3D"||a.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],t[i]={type:a,type2:s,flag:o,value:l}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),a=e.getUint32(),s=e.getUint32();if(a===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}typeof $r>"u"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const o=be(new Uint8Array(e.getArrayBuffer(s))),l=new tn(o.buffer);switch(t){case"b":case"c":return l.getBooleanArray(i);case"d":return l.getFloat64Array(i);case"f":return l.getFloat32Array(i);case"i":return l.getInt32Array(i);case"l":return l.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class tn{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let i=0;i<e;i++)t[i]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),Ft.decodeText(new Uint8Array(t))}}class Hn{add(e,t){this[e]=t}}function ui(r){const e="Kaydara FBX Binary  \0";return r.byteLength>=e.length&&e===Wn(r,0,e.length)}function fi(r){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(i){const a=r[i-1];return r=r.slice(t+i),t++,a}for(let i=0;i<e.length;++i)if(n(1)===e[i])return!1;return!0}function nn(r){const e=/FBXVersion: (\d+)/,t=r.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function hi(r){return r/46186158e3}const pi=[];function qe(r,e,t,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=r;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);const a=i*n.dataSize,s=a+n.dataSize;return gi(pi,n.buffer,a,s)}const pt=new Re,we=new pe;function Zn(r){const e=new b,t=new b,n=new b,i=new b,a=new b,s=new b,o=new b,l=new b,u=new b,f=new b,c=new b,h=new b,p=r.inheritType?r.inheritType:0;if(r.translation&&e.setPosition(we.fromArray(r.translation)),r.preRotation){const F=r.preRotation.map(ae.degToRad);F.push(r.eulerOrder),t.makeRotationFromEuler(pt.fromArray(F))}if(r.rotation){const F=r.rotation.map(ae.degToRad);F.push(r.eulerOrder),n.makeRotationFromEuler(pt.fromArray(F))}if(r.postRotation){const F=r.postRotation.map(ae.degToRad);F.push(r.eulerOrder),i.makeRotationFromEuler(pt.fromArray(F)),i.invert()}r.scale&&a.scale(we.fromArray(r.scale)),r.scalingOffset&&o.setPosition(we.fromArray(r.scalingOffset)),r.scalingPivot&&s.setPosition(we.fromArray(r.scalingPivot)),r.rotationOffset&&l.setPosition(we.fromArray(r.rotationOffset)),r.rotationPivot&&u.setPosition(we.fromArray(r.rotationPivot)),r.parentMatrixWorld&&(c.copy(r.parentMatrix),f.copy(r.parentMatrixWorld));const v=t.clone().multiply(n).multiply(i),g=new b;g.extractRotation(f);const d=new b;d.copyPosition(f);const x=d.clone().invert().multiply(f),w=g.clone().invert().multiply(x),m=a,T=new b;if(p===0)T.copy(g).multiply(v).multiply(w).multiply(m);else if(p===1)T.copy(g).multiply(w).multiply(v).multiply(m);else{const j=new b().scale(new pe().setFromMatrixScale(c)).clone().invert(),E=w.clone().multiply(j);T.copy(g).multiply(v).multiply(E).multiply(m)}const P=u.clone().invert(),A=s.clone().invert();let I=e.clone().multiply(l).multiply(u).multiply(t).multiply(n).multiply(i).multiply(P).multiply(o).multiply(s).multiply(a).multiply(A);const y=new b().copyPosition(I),B=f.clone().multiply(y);return h.copyPosition(B),I=h.clone().multiply(T),I.premultiply(f.invert()),I}function Kn(r){r=r||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return r===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[r]}function vt(r){return r.split(",").map(function(t){return parseFloat(t)})}function Wn(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=r.byteLength),Ft.decodeText(new Uint8Array(r,e,t))}function vi(r,e){for(let t=0,n=r.length,i=e.length;t<i;t++,n++)r[n]=e[t]}function gi(r,e,t,n){for(let i=t,a=0;i<n;i++,a++)r[a]=e[i];return r}function rn(r,e,t){return r.slice(0,e).concat(t).concat(r.slice(e))}const mi=""+new URL("bg-FJa0tkSQ.png",import.meta.url).href,di=""+new URL("cycle--VNC2rUI.png",import.meta.url).href,yi={id:"lunar",class:"webgl"},wi={id:"lunar-webgl",class:"webgl-3d"},xi={class:"loading"},Ti=_e("p",null,"Loading · · ·",-1),Ii={class:"process"},Mi=$n({__name:"index",setup(r){class e extends Ar{constructor(l){super(l);ue(this,"meshes",[]);ue(this,"cycle");ue(this,"group",new mt);ue(this,"plane");ue(this,"gltfLoader");ue(this,"fbxLoader");ue(this,"animateId2");this.myDraw()}initModel(){var l=new Yt(300,300),u=new Fr({opacity:.5}),f=new Qe(l,u);f.rotation.x=-.5*Math.PI,f.position.set(0,-.179,0),f.receiveShadow=!0,this.plane=f,this.scene.add(f),this.cycle=new Qe(new Yt(40,40),new $e({map:new gt().load(di),transparent:!0,side:qt})),this.cycle.rotation.x=-.5*Math.PI,this.cycle.position.set(0,-.18,0),this.cycle.scale.set(.12,.12,.12),this.cycle.receiveShadow=!0,this.scene.add(this.cycle),this.gltfLoader=new Cr(this.manager),this.gltfLoader.load("./models/dragon.gltf",c=>{const h=c.scene;h.traverse(v=>{v.isMesh&&(v.castShadow=!0,v.material.metalness=0,v.material.roughness=.8,v.material.transparent=!0,v.material.side=qt,v.material.color=new ie(16777215))});const p=new Pr(h);p.clipAction(c.animations[3]).setDuration(1.2).play(),this.mixers.push(p),h.rotation.set(0,-59.5,0),h.scale.set(3.8,3.8,3.8),h.position.set(0,-2,0),this.group.add(h)},c=>{},c=>{}),this.fbxLoader=new ii,this.fbxLoader.load("./models/text.fbx",c=>{c.traverse(h=>{h.isMesh&&(this.meshes.push(c),h.castShadow=!0,h.receiveShadow=!0,h.material.metalness=.2,h.material.roughness=.8,h.material.color=new ie(1118481))}),c.position.set(4,24,-20),c.rotation.set(-80,0,0),c.scale.set(.45,.45,.45),this.group.add(c),this.group.scale.set(.1,.1,.1),this.scene.add(this.group)})}initManager(){const l={x:-.04,y:1.9,z:5.4};super.initManager(n,l)}initLight2(){const l=new Dr(.001,.001,.001),u=new an({color:14423578}),f=new Qe(l,u);f.position.set(0,0,0);const c=new on(16777215,1);c.intensity=1,c.position.set(6,5,4),c.castShadow=!0,c.target=f,c.shadow.mapSize.width=512*14,c.shadow.mapSize.height=512*14,c.shadow.camera.top=20,c.shadow.camera.bottom=-20,c.shadow.camera.left=-20,c.shadow.camera.right=20,this.scene.add(c);const h=new ln(16777215);this.scene.add(h);const p=new sn(16777215);p.position.set(20,20,8),p.castShadow=!1,p.target=this.plane,this.scene.add(p)}animate2(){this.cycle.rotation.z+=.3/60,this.animateId2=requestAnimationFrame(this.animate2.bind(this));const l=this.clock.getDelta();this.mixers&&this.mixers.forEach(u=>{u.update(l*.4)})}myDraw(){super.draw(),this.scene.background=new gt().load(mi),this.scene.fog=new Mr(14540253,100,120),this.initManager(),this.initModel(),this.initLight2(),this.animate2()}destroyed(){super.destroyed(t.value),cancelAnimationFrame(this.animateId2)}initCamera(){super.initCamera(),this.camera.position.set(15.658330107719104,10.293379445948675,16.548807746161597)}initRender(){super.initRender({x:-.03605639885864392,y:1.9312043546788207,z:5.392508662632908}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Sr}initControls(){super.initControls(),this.controls.maxPolarAngle=1.5,this.controls.minDistance=4,this.controls.maxDistance=25}}const t=jt(null),n=jt({loadingProcess:0,loadingTimeout:null,sceneReady:!1}),i=Qn(()=>n.value.loadingProcess);function a(){const s=document.getElementById("lunar-webgl");t.value=new e(s),t.value.removeLight()}return Jn(()=>{a()}),Nn(()=>{t.value&&(document.getElementById("lunar-webgl").getElementsByTagName("canvas")[0],t.value.destroyed()),n.value={loadingProcess:0,loadingTimeout:null,sceneReady:!1},t.value=null}),(s,o)=>(ar(),er("div",yi,[_e("div",wi,[tr(rr(Lr,null,{default:ir(()=>[_e("div",xi,[Ti,_e("span",Ii,sr(i.value)+"%",1)])]),_:1},512),[[nr,i.value!=100]])])]))}});export{Mi as default};
