var A=Object.defineProperty;var C=(r,l,d)=>l in r?A(r,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):r[l]=d;var h=(r,l,d)=>(C(r,typeof l!="symbol"?l+"":l,d),d);import{L as k,m as D,V as w,G as I,O as z,n as _,ah as S,D as B,ai as f,k as N,T as F,aj as T,A as E,a5 as R,ak as $,C as V,ag as q,a4 as G,$ as W}from"./loading-8NkDhB87.js";import{d as U,r as v,o as X,a as Y,c as H,b as c,j as J,f as K,k as Q,p as Z,h as ee,g as L,t as te,_ as se}from"./index-DdvX7S44.js";const ae=""+new URL("雪花-9sagENlw.svg",import.meta.url).href,y=r=>(Z("data-v-f3e02a51"),r=r(),ee(),r),ie={class:"webgl",id:"christmas"},oe={id:"christmas-webgl",class:"webgl-3d"},ne={class:"loading"},re=y(()=>c("p",null,"Loading · · ·",-1)),ce={class:"process"},le=y(()=>c("div",{class:"point point-0"},[c("div",{class:"label label-0"},"1"),c("div",{class:"text"},"信封：圣诞老人送来的一封信。圣诞老人郑重声明：不要迷恋爷，爷只是个传说。爷没有会飞的驯鹿，爷的礼物也不多。只好编一条真挚的祝福，祝你平安夜平平安安，圣诞节快快乐乐!")],-1)),de=y(()=>c("div",{className:"point point-1"},[c("div",{className:"label label-1"},"2"),c("div",{className:"text"},"雪人：漫天飞舞的雪花，把大地覆盖成一片雪白，两眼发亮的雪人站在那里，在这白茫茫的大雪中，他显得格外的明亮耀眼。")],-1)),he=U({__name:"index",setup(r){class l extends D{constructor(a,e){super(a,e);h(this,"gltfLoader");h(this,"animateId2");h(this,"cloud");h(this,"range",500);h(this,"speed",.12);h(this,"points",[{position:new w(.2,-1,-.6),element:document.querySelector(".point-0"),class:"point-0"},{position:new w(5,4,4.4),element:document.querySelector(".point-1"),class:"point-1"}]);this.myDraw()}initModel(){this.gltfLoader=new I(this.manager);const a=new z;this.gltfLoader.load("./models/merry_christmas.glb",e=>{const t=e.scene;t.position.set(-8,-1.8,10),t.rotation.set(0,Math.PI/4,0),t.scale.set(.05,.065,.05),t.traverse(s=>{s.isMesh&&(s.name.includes("Box0")?s.castShadow=!1:s.castShadow=!0)}),a.add(t);const i=e.animations[0],o=new _(t);o.clipAction(i).setDuration(1.2).play(),this.mixers.push(o)},e=>{},e=>{}),this.gltfLoader.load("./models/圣诞老人的信4k.glb",e=>{const t=e.scene;t.position.set(-3.9,-2,2.5),t.rotation.set(-Math.PI/2,0,0),t.scale.set(8,8,8),a.add(t);const i=e.animations[0];new _(t).clipAction(i).setDuration(.5).play()},e=>{},e=>{}),this.gltfLoader.load("./models/雪屋.glb",e=>{const t=e.scene;t.position.set(-4,-2,-5),t.rotation.set(0,Math.PI/36,0),t.scale.set(1.8,1.8,1.8),t.traverse(i=>{i.isMesh&&(i.castShadow=!0)}),a.add(t)},e=>{},e=>{}),this.gltfLoader.load("./models/雪地.glb",e=>{const t=e.scene;t.position.set(15,-6.8,5),t.rotation.set(0,Math.PI/2,0),t.scale.set(.5,.5,.5),t.receiveShadow=!0,a.add(t);const i=t.clone();i.scale.set(10,.1,10),i.position.set(-100,-3.3,-380),i.rotation.set(Math.PI,0,0),a.add(i);const o=["Object_5","Object_7","Object_11","Object_13","Object_15","Object_17","Object_19","Object_21","Object_23","Object_25","Object_27","Object_29","Object_31","Object_33","Object_35","Object_37","Object_39"];t.traverse(s=>{if(s.isMesh){const n=new S({color:s.material.color,roughness:.7,metalness:0});s.material=n,s.castShadow=!0,s.receiveShadow=!0,o.includes(s.name)&&(s.visible=!1)}}),i.traverse(s=>{if(s.isMesh){const n=new S({color:s.material.color,side:B});s.material=n,s.receiveShadow=!0,o.includes(s.name)&&(s.visible=!1)}})},e=>{},e=>{}),this.gltfLoader.load("./models/雪人2.glb",e=>{const t=e.scene;t.position.set(1,-.2,8.5),t.rotation.set(0,-Math.PI/3,0),t.scale.set(.6,.6,.6),t.traverse(s=>{s.isMesh&&(s.castShadow=!0)});const i=e.animations[0],o=new _(t);o.clipAction(i).setDuration(.35).play(),this.mixers.push(o),a.add(t)},e=>{},e=>{}),a.position.set(4,0,-4),this.scene.add(a)}initPoint(){document.querySelectorAll(".point").forEach(a=>{a.addEventListener("click",e=>{switch(e.target.classList[e.target.classList.length-1]){case"label-0":f.animateCamera(this.camera,this.controls,{x:-.05667105479061238,y:1.9438436206209484,z:1.499206272744231},{x:0,y:0,z:0},1600,()=>{});break;case"label-1":f.animateCamera(this.camera,this.controls,{x:9.2,y:3.35,z:7.54},{x:0,y:0,z:0},1600,()=>{});break;case"label-2":f.animateCamera(this.camera,this.controls,{x:30,y:10,z:100},{x:0,y:0,z:0},1600,()=>{});break;default:f.animateCamera(this.camera,this.controls,{x:0,y:40,z:140},{x:0,y:0,z:0},1600,()=>{});break}},!1)})}initSnow(a){const e=new N,t=new F().load(ae),i=new T({size:.5,transparent:!0,opacity:.8,map:t,sizeAttenuation:!0,color:16777215,blending:E,depthTest:!1,depthWrite:!1});let o=[];for(let g=0;g<2e3;g++){const x=Math.random()*Math.PI*2,M=Math.random()*this.range/2,P=new w(M*Math.cos(x),Math.random()*this.range-this.range/2,M*Math.sin(x));o.push(...P.toArray())}const s=new R(a||o,3);e.attributes.position=s;const n=new $(e,i);return n.raycast=()=>{},n.position.set(0,-10,0),n.scale.set(.5,1,.5),this.scene.add(n),n}animate2(){this.animateId2=requestAnimationFrame(this.animate2.bind(this));const a=this.clock.getDelta();if(this.mixers.forEach(e=>{e.update(a*.08)}),u.value.sceneReady)for(const e of this.points){const t=e.position.clone();t.project(this.camera),this.raycaster.setFromCamera(t,this.camera);const i=this.raycaster.intersectObjects(this.scene.children,!0);if(i.length===0)e.element.className=`point ${e.class} visible`;else{const n=i[0].distance,g=e.position.distanceTo(this.camera.position);e.element&&(e.element.className=n<g?`point ${e.class}`:`point ${e.class} visible`)}const o=t.x*b.value.width*.5,s=-t.y*b.value.height*.5;e.element&&(e.element.style.transform=`translateX(${o}px) translateY(${s}px)`)}if(this.cloud){this.scene.remove(this.cloud);let e=Array.from(this.cloud.geometry.attributes.position.array);for(let t=0;t<e.length;t+=3)e[t+1]-=this.speed,e[t+1]<0&&(e[t+1]=Math.random()*this.range-this.range/2);this.cloud=this.initSnow(e)}}myDraw(){this.scene.background=new V(3355443),this.initManager(),this.initModel(),this.initPoint(),this.cloud=this.initSnow(),this.initControls(),this.animate2()}initRender(){super.initRender(d),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=q}initCamera(){super.initCamera(),this.camera.near=1,this.camera.position.set(107,100,64)}initLight(){var a=new G(16777215,.8);a.name="_ambientLight",this.scene.add(a);const e=new W(16777215,.1);e.position.set(20,25,5),e.castShadow=!0,e.shadow.mapSize.width=512*4,e.shadow.mapSize.height=512*4,e.shadow.camera.top=20,e.shadow.camera.bottom=-20,e.shadow.camera.left=-20,e.shadow.camera.right=20,this.scene.add(e)}initControls(){super.initControls(),this.controls.maxPolarAngle=1.5,this.controls.minDistance=2,this.controls.maxDistance=180,this.controls.enablePan=!1}initManager(){super.initManager(u,d)}destroyed(){super.destroyed(m.value),cancelAnimationFrame(this.animateId2),this.cloud=null}}const d={x:13.4,y:12.6,z:24.9},m=v(null),u=v({loadingProcess:0,loadingTimeout:null,sceneReady:!1}),b=v({width:0,height:0});function j(){const p=document.getElementById("christmas-webgl");b.value={width:p.offsetWidth,height:p.offsetHeight},m.value=new l(p,{logarithmicDepthBuffer:!1})}return X(()=>{j()}),Y(()=>{m.value&&m.value.destroyed(),m.value=null}),(p,O)=>(L(),H("div",ie,[c("div",oe,[u.value.loadingProcess<100?(L(),J(k,{key:0},{default:K(()=>[c("div",ne,[re,c("span",ce,te(u.value.loadingProcess)+"%",1)])]),_:1})):Q("",!0),le,de])]))}}),ge=se(he,[["__scopeId","data-v-f3e02a51"]]);export{ge as default};
